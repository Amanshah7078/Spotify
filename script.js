// Music Data
const musicData = {
    featuredTracks: [
        {
            title: "Energy",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/energy.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-energy.mp3"
        },
        {
            title: "Summer",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/summer.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-summer.mp3"
        },
        {
            title: "Creative Minds",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/creativeminds.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-creativeminds.mp3"
        },
        {
            title: "Acoustic Breeze",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/acousticbreeze.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-acousticbreeze.mp3"
        },
        {
            title: "Sunny",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/sunny.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-sunny.mp3"
        },
        {
            title: "Tenderness",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/tenderness.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-tenderness.mp3"
        },
        {
            title: "Epic",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/epic.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-epic.mp3"
        },
        {
            title: "Memories",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/memories.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-memories.mp3"
        },
        {
            title: "Adventure",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/adventure.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-adventure.mp3"
        },
        {
            title: "Happy Rock",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/happyrock.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-happyrock.mp3"
        },
        {
            title: "Jazz Comedy",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/jazzcomedy.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-jazzcomedy.mp3"
        },
        {
            title: "Retro Soul",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/retrosoul.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-retrosoul.mp3"
        },
        {
            title: "Ukulele",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/ukulele.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-ukulele.mp3"
        },
        {
            title: "Sweet",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/sweet.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-sweet.mp3"
        },
        {
            title: "Funky Element",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/funkyelement.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-funkyelement.mp3"
        },
        {
            title: "Dance",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/dance.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-dance.mp3"
        },
        {
            title: "Dubstep",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/dubstep.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-dubstep.mp3"
        },
        {
            title: "Moose",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/moose.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-moose.mp3"
        },
        {
            title: "Brazil Samba",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/brazilsamba.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-brazilsamba.mp3"
        },
        {
            title: "House",
            artist: "Bensound",
            coverUrl: "https://www.bensound.com/bensound-img/house.jpg",
            audioUrl: "https://www.bensound.com/bensound-music/bensound-house.mp3"
        }
    ],
    playlists: [
        {
            title: "Electronic Vibes",
            description: "Best electronic tracks",
            coverUrl: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=500&auto=format",
            tracks: [0, 1, 4, 15, 16, 19]
        },
        {
            title: "Acoustic Sessions",
            description: "Relaxing acoustic songs",
            coverUrl: "https://images.unsplash.com/photo-1510915361894-db8b60106cb1?w=500&auto=format",
            tracks: [2, 3, 5, 7, 12, 13]
        },
        {
            title: "Summer Mix",
            description: "Perfect for sunny days",
            coverUrl: "https://images.unsplash.com/photo-1473496169904-658ba7c44d8a?w=500&auto=format",
            tracks: [1, 4, 2, 9, 14, 18]
        },
        {
            title: "Chill Out",
            description: "Relaxing tunes for your day",
            coverUrl: "https://images.unsplash.com/photo-1483412033650-1015ddeb83d1?w=500&auto=format",
            tracks: [5, 3, 0, 8, 11, 17]
        },
        {
            title: "Jazz & Soul",
            description: "Smooth jazz and soul collection",
            coverUrl: "https://images.unsplash.com/photo-1415201364774-f6f0bb35f28f?w=500&auto=format",
            tracks: [10, 11, 14, 17, 18, 19]
        },
        {
            title: "Dance Party",
            description: "Get the party started!",
            coverUrl: "https://images.unsplash.com/photo-1429962714451-bb934ecdc4ec?w=500&auto=format",
            tracks: [15, 16, 19, 6, 9, 14]
        },
        {
            title: "World Music",
            description: "Explore global sounds",
            coverUrl: "https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?w=500&auto=format",
            tracks: [18, 12, 7, 4, 1, 8]
        },
        {
            title: "Focus Flow",
            description: "Music for concentration",
            coverUrl: "https://images.unsplash.com/photo-1483412468200-72182dbbc544?w=500&auto=format",
            tracks: [2, 5, 7, 13, 3, 11]
        }
    ]
};

// Audio Player Elements
const audioPlayer = document.getElementById('audio-player');
const playPauseBtn = document.getElementById('play-pause');
const prevBtn = document.getElementById('prev-button');
const nextBtn = document.getElementById('next-button');
const currentTrackImage = document.getElementById('current-track-image');
const currentTrackName = document.getElementById('current-track-name');
const currentArtistName = document.getElementById('current-artist-name');
const currentTimeEl = document.getElementById('current-time');
const totalTimeEl = document.getElementById('total-time');
const progressBar = document.querySelector('.progress');
const volumeProgress = document.querySelector('.volume-progress');
const volumeButton = document.querySelector('.volume');

// Player State
let isPlaying = false;
let currentTrackIndex = 0;
let currentPlaylist = [];
let shuffledPlaylist = [];

// Initialize Featured Tracks
function createFeaturedTracks() {
    const featuredContainer = document.getElementById('featured-tracks');
    featuredContainer.innerHTML = '';
    
    musicData.featuredTracks.forEach((track, index) => {
        const trackElement = document.createElement('div');
        trackElement.className = 'featured-item';
        trackElement.innerHTML = `
            <img src="${track.coverUrl}" alt="${track.title}">
            <div class="track-info">
                <h4>${track.title}</h4>
                <p>${track.artist}</p>
            </div>
        `;
        trackElement.addEventListener('click', () => {
            currentPlaylist = [...Array(musicData.featuredTracks.length).keys()];
            currentTrackIndex = index;
            shuffledPlaylist = [...currentPlaylist];
            loadAndPlayTrack(track);
        });
        featuredContainer.appendChild(trackElement);
    });
}

// Initialize Playlist Cards
function createPlaylistCards() {
    const playlistContainer = document.getElementById('playlist-container');
    playlistContainer.innerHTML = '';
    
    musicData.playlists.forEach((playlist, index) => {
        const playlistCard = document.createElement('div');
        playlistCard.className = 'card';
        playlistCard.innerHTML = `
            <img src="${playlist.coverUrl}" alt="${playlist.title}">
            <h4>${playlist.title}</h4>
            <p>${playlist.description}</p>
            <div class="play-button">
                <i class="fas fa-play"></i>
            </div>
        `;
        playlistCard.addEventListener('click', () => {
            currentPlaylist = playlist.tracks;
            currentTrackIndex = 0;
            shuffledPlaylist = [...currentPlaylist];
            loadAndPlayTrack(musicData.featuredTracks[currentPlaylist[0]]);
        });
        playlistContainer.appendChild(playlistCard);
    });
}

// Load and play track
function loadAndPlayTrack(track) {
    if (!track) return;
    
    // Show loading state
    currentTrackName.textContent = 'Loading...';
    playPauseBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    
    // Update track info
    currentTrackImage.src = track.coverUrl;
    currentTrackName.textContent = track.title;
    currentArtistName.textContent = track.artist;
    
    // Load and play audio
    audioPlayer.src = track.audioUrl;
    
    const playPromise = audioPlayer.play();
    if (playPromise !== undefined) {
        playPromise
            .then(() => {
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="far fa-pause-circle"></i>';
            })
            .catch(error => {
                console.error('Error playing track:', error);
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="far fa-play-circle"></i>';
                currentTrackName.textContent = 'Error playing track';
                currentArtistName.textContent = 'Please try again';
            });
    }
}

// Play/Pause Controls
function playTrack() {
    audioPlayer.play();
    isPlaying = true;
    playPauseBtn.innerHTML = '<i class="far fa-pause-circle"></i>';
}

function pauseTrack() {
    audioPlayer.pause();
    isPlaying = false;
    playPauseBtn.innerHTML = '<i class="far fa-play-circle"></i>';
}

playPauseBtn.addEventListener('click', () => {
    if (isPlaying) {
        pauseTrack();
    } else {
        playTrack();
    }
});

// Previous Track
prevBtn.addEventListener('click', () => {
    if (currentTrackIndex > 0) {
        currentTrackIndex--;
    } else {
        currentTrackIndex = currentPlaylist.length - 1;
    }
    loadAndPlayTrack(musicData.featuredTracks[currentPlaylist[currentTrackIndex]]);
});

// Next Track
nextBtn.addEventListener('click', () => {
    if (currentTrackIndex < currentPlaylist.length - 1) {
        currentTrackIndex++;
    } else {
        currentTrackIndex = 0;
    }
    loadAndPlayTrack(musicData.featuredTracks[currentPlaylist[currentTrackIndex]]);
});

// Update Progress Bar
audioPlayer.addEventListener('timeupdate', () => {
    const currentTime = audioPlayer.currentTime;
    const duration = audioPlayer.duration;
    
    if (duration) {
        const progressPercent = (currentTime / duration) * 100;
        progressBar.style.width = `${progressPercent}%`;
        
        const currentMinutes = Math.floor(currentTime / 60);
        const currentSeconds = Math.floor(currentTime % 60);
        currentTimeEl.textContent = `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')}`;
        
        const totalMinutes = Math.floor(duration / 60);
        const totalSeconds = Math.floor(duration % 60);
        totalTimeEl.textContent = `${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
    }
});

// Volume Control and Progress Bar Functionality
const volumeBar = document.querySelector('.volume-bar');
const progressBarContainer = document.querySelector('.progress-bar');

// Progress bar click handling
progressBarContainer.addEventListener('click', (e) => {
    const rect = progressBarContainer.getBoundingClientRect();
    const clickPosition = e.clientX - rect.left;
    const percentageClicked = clickPosition / rect.width;
    
    if (audioPlayer.duration) {
        audioPlayer.currentTime = percentageClicked * audioPlayer.duration;
        progressBar.style.width = `${percentageClicked * 100}%`;
    }
});

// Volume bar click handling
volumeBar.addEventListener('click', (e) => {
    const rect = volumeBar.getBoundingClientRect();
    const clickPosition = e.clientX - rect.left;
    const newVolume = Math.max(0, Math.min(1, clickPosition / rect.width));
    
    updateVolume(newVolume);
});

// Volume drag functionality
let isDraggingVolume = false;

volumeBar.addEventListener('mousedown', () => {
    isDraggingVolume = true;
});

document.addEventListener('mousemove', (e) => {
    if (isDraggingVolume) {
        const rect = volumeBar.getBoundingClientRect();
        const clickPosition = e.clientX - rect.left;
        const newVolume = Math.max(0, Math.min(1, clickPosition / rect.width));
        
        updateVolume(newVolume);
    }
});

document.addEventListener('mouseup', () => {
    isDraggingVolume = false;
});

// Progress bar drag functionality
let isDraggingProgress = false;

progressBarContainer.addEventListener('mousedown', () => {
    isDraggingProgress = true;
});

document.addEventListener('mousemove', (e) => {
    if (isDraggingProgress && audioPlayer.duration) {
        const rect = progressBarContainer.getBoundingClientRect();
        const clickPosition = e.clientX - rect.left;
        const percentageClicked = Math.max(0, Math.min(1, clickPosition / rect.width));
        
        audioPlayer.currentTime = percentageClicked * audioPlayer.duration;
        progressBar.style.width = `${percentageClicked * 100}%`;
    }
});

document.addEventListener('mouseup', () => {
    isDraggingProgress = false;
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    // Space bar to play/pause
    if (e.code === 'Space' && e.target === document.body) {
        e.preventDefault();
        if (isPlaying) {
            pauseTrack();
        } else {
            playTrack();
        }
    }
    
    // Left arrow for previous track
    if (e.code === 'ArrowLeft' && e.ctrlKey) {
        e.preventDefault();
        if (currentTrackIndex > 0) {
            currentTrackIndex--;
            loadAndPlayTrack(musicData.featuredTracks[currentPlaylist[currentTrackIndex]]);
        }
    }
    
    // Right arrow for next track
    if (e.code === 'ArrowRight' && e.ctrlKey) {
        e.preventDefault();
        if (currentTrackIndex < currentPlaylist.length - 1) {
            currentTrackIndex++;
            loadAndPlayTrack(musicData.featuredTracks[currentPlaylist[currentTrackIndex]]);
        }
    }
    
    // Up/Down arrows for volume
    if (e.code === 'ArrowUp' && e.ctrlKey) {
        e.preventDefault();
        const newVolume = Math.min(1, audioPlayer.volume + 0.1);
        updateVolume(newVolume);
    }
    
    if (e.code === 'ArrowDown' && e.ctrlKey) {
        e.preventDefault();
        const newVolume = Math.max(0, audioPlayer.volume - 0.1);
        updateVolume(newVolume);
    }
});

// Update volume with visual feedback
function updateVolume(volume) {
    audioPlayer.volume = volume;
    volumeProgress.style.width = `${volume * 100}%`;
    lastVolume = volume;
    updateVolumeIcon(volume);
    
    // Add volume indicator popup
    const volumeIndicator = document.createElement('div');
    volumeIndicator.className = 'volume-indicator';
    volumeIndicator.textContent = `${Math.round(volume * 100)}%`;
    volumeBar.appendChild(volumeIndicator);
    
    // Remove the indicator after a short delay
    setTimeout(() => {
        volumeIndicator.remove();
    }, 1000);
}

// Auto-advance to next track when current track ends
audioPlayer.addEventListener('ended', () => {
    if (currentTrackIndex < currentPlaylist.length - 1) {
        currentTrackIndex++;
        loadAndPlayTrack(musicData.featuredTracks[currentPlaylist[currentTrackIndex]]);
    } else {
        // Reset to first track if at end of playlist
        currentTrackIndex = 0;
        loadAndPlayTrack(musicData.featuredTracks[currentPlaylist[currentTrackIndex]]);
    }
});

// Initialize the app
function init() {
    createFeaturedTracks();
    createPlaylistCards();
    
    // Set up initial playlist
    currentPlaylist = [...Array(musicData.featuredTracks.length).keys()];
    shuffledPlaylist = [...currentPlaylist];
    
    // Set initial volume
    audioPlayer.volume = 0.7;
    volumeProgress.style.width = '70%';
    updateVolumeIcon(0.7);
}

// Start the app
init();
